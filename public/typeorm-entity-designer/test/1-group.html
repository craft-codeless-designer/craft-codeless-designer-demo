<!DOCTYPE html>
<html>
  <head>
    <title>Group</title>
    <script src="../node_modules/fabric/dist/fabric.js"></script>
  </head>
  <body>
    <div><canvas id="container" style="border: 1px solid #ccc" width="800" height="600"></canvas></div>
    <script>
      let canvas = new fabric.Canvas('container');

      //Group-1
      let rect1 = new fabric.Rect({
        width: 200,
        height: 200,
        fill: '#fee',
        stroke: 'black',
      });

      let text1 = new fabric.Text('User', {
        fontSize: 28,
      });

      let text2 = new fabric.Text('UserName', {
        fontSize: 18,
      });

      let text3 = new fabric.Text('Age', {
        fontSize: 18,
      });

      let line1 = new fabric.Line([0, 0, 200, 0], {
        stroke: 'black',
      });

      let boundingRect = rect1.getBoundingRect();
      let group = new fabric.Group([], {
        width: boundingRect.width,
        height: boundingRect.height,
        hasControls: false,
        padding: 5,
        borderColor: '#ff3300',
      });
      group.addWithUpdate(rect1);
      group.addWithUpdate(text1);
      group.addWithUpdate(line1);
      group.addWithUpdate(text2);
      group.addWithUpdate(text3);

      canvas.add(group);
      group.center();

      let objs = group.getObjects();
      let temp = 0;
      for (let i = 1; i < objs.length; i++) {
        let rect = objs[i].getBoundingRect();
        objs[i].setOptions({ top: rect.top + temp });
        temp += rect.height;
      }

      //Gropu-2
      let rect2 = new fabric.Rect({
        width: 200,
        height: 200,
        fill: '#fee',
        stroke: 'black',
      });
      canvas.add(rect2);

      function makeLine(coords) {
        return new fabric.Line(coords, {
          fill: 'red',
          stroke: 'red',
          strokeWidth: 5,
          selectable: false,
          evented: false,
        });
      }

      let line2 = makeLine([group.left, group.top, rect2.left, rect2.top]);
      canvas.add(line2);

      rect2.line2 = line2;
      group.line2 = line2;
      line2.start = group;
      line2.end = rect2;

      canvas.on('object:moving', function (e) {
        let p = e.target;
        if (p.line2 && p.line2.start === p) {
          p.line2.set({ x1: p.left, y1: p.top });
        }
        if (p.line2 && p.line2.end === p) {
          p.line2.set({ x2: p.left, y2: p.top });
        }
        canvas.renderAll();
      });

      console.log(rect2.id);

      console.log(canvas.toJSON());
    </script>
  </body>
</html>
